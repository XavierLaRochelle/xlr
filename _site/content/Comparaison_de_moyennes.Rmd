---
title: "Comparaison de moyennes"
author: "Xavier La Rochelle"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    number_section: true
    theme: readable
---

---

```{r setup, include=FALSE}
# Packages
library(knitr)
library(readr)
library(tibble)
library(sjmisc)
library(jmv)
library(ggplot2)

# Affichage
opts_chunk$set()

# Importer les données
donnees_brutes <- read_csv("~/OneDrive/Documents/Udem/Hiver 2023/PSY1004/Ateliers R/Guide/data/data_visualisation.csv") 

# Préparer les données 
df <- as_tibble(data.frame(id = 1:nrow(donnees_brutes)))
df$genre <- factor(donnees_brutes$Genre,
                   levels = c(1,2),
                   labels = c("Homme",
                              "Femme"))
df$emotionPositive <- donnees_brutes$PANAS_Pos_Pre
```

***Important :*** Ce guide assume que vous savez comment :  

1. rédiger un script RMarkdown (`script_rmarkdown.html`)  
2. installer et activer des packages (`packages.html`) 
3. importer une base de données (`importer_les_donnees.html`)  
4. préparer une base de données (`preparer_les_donnees.html`)  

Les guides associés à chacune de ces étapes sont disponibles sur Studium.  

---

## Importer et préparer les données

Dans ce guide, nous utiliserons deux variables du fichier `data_visualisation.csv`, soit le Genre (`genre`) et les émotions positives (`emotionPositive`). Pour vous évitez de tout re-coder, j'ai pris le temps d'écrire la syntaxe nécessaire pour importer et préparer les données : 
```{r, eval=FALSE}
# Packages
library(readr)
library(tibble)

# Importer les données (data_visualisation.csv)
donnees_brutes <- read_csv("folder path")  

# Préparer les données 
df <- as_tibble(data.frame(id = 1:nrow(donnees_brutes)))
df$genre <- factor(donnees_brutes$Genre,
                   levels = c(1,2),
                   labels = c("Homme", "Femme"))
df$emotionPositive <- donnees_brutes$PANAS_Pos_Pre
```

Pour suivre les exemples dans ce guide, vous devrez donc :  
1. avoir téléchargé le fichier `data_visualisation.csv` sur Studium  
2. noter le `"folder path"` 
3. utiliser la syntaxe suivante pour préparer les données dans R :  

*Note: N'oubliez pas de changer le folder path!*

Voici à quoi devrait ressembler votre banque de données après l'étape de préparation :
```{r}
df
```

# Comparer des moyennes
Cette section explique comment obtenir la moyenne et l'intervalle de confiance d'une variable continue pour plusieurs groupes (variable discrète). À titre d'exemple, nous utiliserons les émotions positives (`emotionPositive`) comme variable continue et le genre (`genre`) comme variable discrète.

## Scinder le output par groupe
Nous avons déjà vue dans le guide `preparer_les_donnees.html` qu'il est possible d'obtenir des statistiques descriptives, dont la moyenne, d'une variable à partir de la fonction `descriptives()` du package `jmv` (voir section 2.2.1). Toutefois, la syntaxe présentée précédemment ne permettait pas à elle seule d'obtenir, pour une variable continue, les moyennes *relatives à différents groupes*. Pour ce faire, il vous devrez ajouter l'argument `splitBy =` à la fonction `descriptives()`. Comme son nom l'indique, cet argument a pour effet de scinder le *output* généré en fonction des catégories de la variable indiquée. Par exemple : 
```{r}
descriptives(df, emotionPositive, 
             splitBy = genre)
```

## Intervalle de confiance
Une fois le *output* scindé, il ne vous reste qu'à utiliser l'argument `ci = TRUE` pour obtenir les limites inférieure et supérieure de l'intervalle de confiance de vos groupes. Par exemple :
```{r}
descriptives(df, emotionPositive, 
             splitBy = genre, 
             ci = TRUE)
```

### Détails supplémentaires : Intervalle de confiance et hypothèse nulle
Si vous essayez de calculer à la main l'intervalle de confiance à partir de la formule présentée dans le manuel ([Haccoun et Cousineau, 2010](https://canadacommons.ca/artifacts/1882749/statistiques/2631904/view/), formule 9.5, p. 271), vous arriverez peut-être à des résultats différents de ceux obtenus à l'aide de la fonctions `descriptives()`. Cette différence est (probablement) dû au fait que la fonction `descriptives()` calculent l'intervalle de confiance à partir de l'erreur-type de chaque groupe pris individuellement (plutôt que d'utiliser l'erreur-type de l’échantillon complet). Dans un contexte d'inférence statistique (ex.: test-t), il est plus cohérent d'estimer l’erreur-type de la moyenne à partir de l’échantillon complet puisqu’on cherche à représenter l’hypothèse nulle. Cependant, obtenir un intervalle calculer de cette manière nécessite de coder manuellement la formule dans R, ce qui résulte en une syntaxe beaucoup trop complexe pour ce cours. Pour ceux que ça intéresse, la voici : 
```{r, message=FALSE}
library(dplyr)
library(tidyr)

# Cacluler l'erreur-type de la moyenne (s_M)
s <- df %>% 
        drop_na(emotionPositive) %>% 
        pull(emotionPositive) %>% 
        sd()
N <- df %>% 
        drop_na(emotionPositive) %>% 
        pull(emotionPositive) %>% 
        length()
s_M <- s / sqrt(N)

# Calculer le score Z limite
conf.int <- 0.95
Z <- qnorm((1 + conf.int)/2)

# Calculer les limites de l'IC et présenter dans un tableau
options(pillar.sigfig = 4)
df %>%
  drop_na(emotionPositive) %>% 
  group_by(genre) %>% 
  summarise(Moyenne = mean(emotionPositive),
            IC_inf = mean(emotionPositive) - Z * s_M,
            IC_sup = mean(emotionPositive) + Z * s_M)
```

Dans le cadre de votre TP, vous pourrez présenter l'intervalle de confiance obtenus à partir de la fonction `descriptives()`.

